<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="./css/style.css" />
    <link rel="stylesheet" href="./css/reset.css" />
  </head>
  <body>
    <div class="container">
      <header>
        <div class="wrap_header">
          <h1 class="title">画像検索</h1>

          <form method="PUT" class="header_form">
            <input class="header_textarea" type="text" name="src_text" />
            <div class="wrap_header_radio-btn">
              <label>
                <input type="radio" name="show_sync" value="20" />20
              </label>
              <label>
                <input type="radio" name="show_sync" value="100" />100
              </label>
            </div>
            <button class="form_btn" type="button">検索</button>
          </form>
        </div>
      </header>
      <main>
        <p class="search_before">検索ワードを入力してください。</p>
        <div class="img_box">
          <!-- <div class="wrap_img">
            <img src="https://source.unsplash.com/random" class="img_grid" />
          </div>
          <div class="wrap_img">
            <img src="https://source.unsplash.com/random" class="img_grid" />
          </div>
          <div class="wrap_img">
            <img src="https://source.unsplash.com/random" class="img_grid" />
          </div>
          <div class="wrap_img">
            <img src="https://source.unsplash.com/random" class="img_grid" />
          </div>
          <div class="wrap_img">
            <img src="https://source.unsplash.com/random" class="img_grid" />
          </div>
          <div class="wrap_img">
            <img src="https://source.unsplash.com/random" class="img_grid" />
          </div>
          <div class="wrap_img">
            <img src="https://source.unsplash.com/random" class="img_grid" />
          </div>
          <div class="wrap_img">
            <img src="https://source.unsplash.com/random" class="img_grid" />
          </div>
          <div class="wrap_img">
            <img src="https://source.unsplash.com/random" class="img_grid" />
          </div> -->
          <div id="imageContainer"></div>
        </div>
      </main>
    </div>
  </body>
  <script>
    //formデータ受け取り、非同期でunsplash api取得

    const form_async_btn = document.querySelector(".form_btn");
    form_async_btn.addEventListener("click", (e) => {
      e.preventDefault();
      const form_async = document.querySelector(".header_form");
      const form_async_data = new FormData(form_async);
      const form_async_data_json = Object.fromEntries(form_async_data);
      // console.log(form_async_data_json.src_text);
      // console.log(form_async_data_json);
      const src_word = form_async_data_json.src_text;
      const show_num = form_async_data_json.show_sync;
      // console.log(src_word);
      // console.log(show_num);
      const ACCESS_KEY = "6m-MrXZxcBmmmhhHQB92dmtYICSQ4OUruyA-wO3XEx4";
      const fetch_url =
        "https://api.unsplash.com/search/photos?query=" +
        src_word +
        "&client_id=" +
        ACCESS_KEY;

      console.log(fetch_url);

      sendFormAsync(form_async_data_json, fetch_url, show_num);
    });

    const sendFormAsync = async (send_json_data, url, show_num) => {
      const res = await fetch(url);

      const data = await res.json();
      console.log(data);
      const img_url = [];
      // console.log(data.results[0].urls.raw);
      // for (let i = 0; i < data.length; i++) {
      for (let i = 0; i < show_num; i++) {
        img_url[i] = data.results[i].urls.raw;
        // console.log(img_url[i]);
        var imageContainer = document.getElementById("imageContainer");

        // 新しいImage要素を作成
        var imageElement = document.createElement("img");

        // Image要素のsrc属性にURLを設定
        imageElement.src = img_url[i];

        // Image要素をdivに追加
        imageContainer.appendChild(imageElement);
      }
      //画像をhoverした時の動作（ズーム、ブラー）
      const img_hvr = document.querySelector(".img_grid");
      img_hvr.addEventListener("mouseover", () => {
        img_hvr.classList.toggle(":hover");
      });
    };

    //
  </script>
</html>
