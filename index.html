<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="./css/style.css" />
    <link rel="stylesheet" href="./css/reset.css" />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />
  </head>
  <body>
    <div class="container">
      <header>
        <div class="wrap_header">
          <h1 class="title">画像検索</h1>

          <form method="PUT" class="header_form">
            <input class="header_textarea" type="text" name="src_text" />
            <div class="wrap_header_radio-btn">
              <label>
                <input type="radio" name="show_sync" value="20" />20
              </label>
              <label>
                <input type="radio" name="show_sync" value="100" />100
              </label>
            </div>
            <button class="form_btn" type="button">検索</button>
          </form>
        </div>
      </header>
      <main>
        <p class="search_before">検索ワードを入力してください。</p>
        <div class="img_box">
          <div id="imageContainer"></div>
        </div>
      </main>
    </div>
  </body>
  <script>
    let form_async_btn = document.querySelector(".form_btn");

    form_async_btn.addEventListener("click", (e) => {
      // e.preventDefault();

      let form_async = document.querySelector(".header_form");
      let form_async_data = new FormData(form_async);
      let form_async_data_json = Object.fromEntries(form_async_data);
      // console.log(form_async_data_json.src_text);
      console.log(form_async_data_json);
      let src_word = form_async_data_json.src_text;
      let show_num = form_async_data_json.show_sync;
      // console.log(src_word);
      // console.log(show_num);
      const ACCESS_KEY = "6m-MrXZxcBmmmhhHQB92dmtYICSQ4OUruyA-wO3XEx4";
      let fetch_url =
        "https://api.unsplash.com/search/photos?query=" +
        src_word +
        "&per_page=" +
        show_num +
        "&client_id=" +
        ACCESS_KEY;

      sendFormAsync(fetch_url, show_num);

      //画像をhoverした時の動作（ズーム、ブラー）
      // const img_hvr = document.querySelector(".img_grid");
      // img_hvr.addEventListener("mouseover", () => {
      //   console.log("hover");
      //   img_hvr.classList.toggle("hover");
      // });
    });

    const sendFormAsync = async (url, show_num) => {
      const res = await fetch(url);
      const data = await res.json();
      // console.log(data);
      // console.log(data.results[0].urls.raw);

      for (let i = 0; i < show_num; i++) {
        // console.log(img_url[i]);

        const imageContainer = document.getElementById("imageContainer");

        // タグを生成
        const divElement = document.createElement("div");
        const imageElement = document.createElement("img");
        divElement.className = "wrap_img";
        imageElement.src = data.results[i].urls.regular;
        imageElement.className = "img_grid";
        divElement.appendChild(imageElement);

        // アイコンをオーバーレイさせる
        const iconSpan = document.createElement("span");
        iconSpan.className = "material-symbols-outlined";
        iconSpan.innerText = "download_for_offline"; // アイコンのテキストを設定
        divElement.appendChild(iconSpan);

        imageContainer.appendChild(divElement);
      }
    };
  </script>
</html>
